{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import'./AttendancePage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AttendancePage=_ref=>{let{user,onLogout}=_ref;const[studentId,setStudentId]=useState('');const[student,setStudent]=useState(null);const[message,setMessage]=useState('');const[status,setStatus]=useState('');const[isLoading,setIsLoading]=useState(false);const inputRef=useRef(null);const successAudioRef=useRef(null);const errorAudioRef=useRef(null);useEffect(()=>{// Focus on input when component mounts\nif(inputRef.current){inputRef.current.focus();}},[]);const playSound=isSuccess=>{try{if(isSuccess&&successAudioRef.current){successAudioRef.current.play();}else if(!isSuccess&&errorAudioRef.current){errorAudioRef.current.play();}}catch(error){console.log('Audio playback failed:',error);}};const handleSubmit=async e=>{e.preventDefault();if(!studentId.trim())return;setIsLoading(true);setMessage('');setStudent(null);try{const response=await fetch('/api/attendance',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({studentId:studentId.trim()})});const data=await response.json();if(response.ok){setStudent(data.student);setStatus(data.status);switch(data.status){case'allowed':setMessage('✅ Meal allowed! Welcome!');playSound(true);break;case'already_used':setMessage('❌ Meal already used for this period');playSound(false);break;case'invalid':setMessage('❌ Student ID not found');playSound(false);break;default:setMessage('❌ Unknown status');playSound(false);}}else{setMessage('❌ System error. Please try again.');playSound(false);}}catch(error){setMessage('❌ Network error. Please check connection.');playSound(false);}finally{setIsLoading(false);setStudentId('');// Refocus input for next scan\nsetTimeout(()=>{if(inputRef.current){inputRef.current.focus();}},100);}};const handleLogout=async()=>{try{await fetch('/api/logout',{method:'POST'});onLogout();}catch(error){console.error('Logout error:',error);onLogout();// Logout anyway\n}};return/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-left\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/salale_university_logo.png\",alt:\"Salale University\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"Salale University\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,className:\"logout-btn\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-out-alt\"}),\"Logout\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"attendance-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-layout\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-card\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"studentId\",children:\"Student ID (Manual or Scan Barcode):\"}),/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",id:\"studentId\",value:studentId,onChange:e=>setStudentId(e.target.value),placeholder:\"Enter ID\",autoComplete:\"off\",required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"check-btn\",disabled:isLoading,children:isLoading?'Checking...':'Check Attendance'})]}),message&&/*#__PURE__*/_jsx(\"div\",{className:\"attendance-message \".concat(status),children:message})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"result-section\",children:student&&/*#__PURE__*/_jsxs(\"div\",{className:\"student-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"status-message \".concat(status),children:status==='allowed'?'✅ ALLOWED':status==='already_used'?'❌ ALREADY USED':'❌ DENIED'}),/*#__PURE__*/_jsxs(\"div\",{className:\"student-info-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"student-details\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",student.name]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"ID Number:\"}),\" \",student.id]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Program:\"}),\" \",student.department]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"student-photo\",children:/*#__PURE__*/_jsx(\"img\",{src:student.photoUrl||'/images/default-student.png',alt:\"Student Photo\",onError:e=>{e.target.src='/images/default-student.png';}})})]})]})})]})}),/*#__PURE__*/_jsx(\"audio\",{ref:successAudioRef,preload:\"auto\",children:/*#__PURE__*/_jsx(\"source\",{src:\"/sounds/success.mp3\",type:\"audio/mpeg\"})}),/*#__PURE__*/_jsx(\"audio\",{ref:errorAudioRef,preload:\"auto\",children:/*#__PURE__*/_jsx(\"source\",{src:\"/sounds/error.mp3\",type:\"audio/mpeg\"})})]});};export default AttendancePage;","map":{"version":3,"names":["React","useState","useRef","useEffect","jsx","_jsx","jsxs","_jsxs","AttendancePage","_ref","user","onLogout","studentId","setStudentId","student","setStudent","message","setMessage","status","setStatus","isLoading","setIsLoading","inputRef","successAudioRef","errorAudioRef","current","focus","playSound","isSuccess","play","error","console","log","handleSubmit","e","preventDefault","trim","response","fetch","method","headers","body","JSON","stringify","data","json","ok","setTimeout","handleLogout","className","children","src","alt","onClick","onSubmit","htmlFor","ref","type","id","value","onChange","target","placeholder","autoComplete","required","disabled","concat","name","department","photoUrl","onError","preload"],"sources":["C:/Users/hp/OneDrive/Desktop/Intern/src/components/AttendancePage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport './AttendancePage.css';\n\nconst AttendancePage = ({ user, onLogout }) => {\n  const [studentId, setStudentId] = useState('');\n  const [student, setStudent] = useState(null);\n  const [message, setMessage] = useState('');\n  const [status, setStatus] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const inputRef = useRef(null);\n  const successAudioRef = useRef(null);\n  const errorAudioRef = useRef(null);\n\n  useEffect(() => {\n    // Focus on input when component mounts\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  const playSound = (isSuccess) => {\n    try {\n      if (isSuccess && successAudioRef.current) {\n        successAudioRef.current.play();\n      } else if (!isSuccess && errorAudioRef.current) {\n        errorAudioRef.current.play();\n      }\n    } catch (error) {\n      console.log('Audio playback failed:', error);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!studentId.trim()) return;\n\n    setIsLoading(true);\n    setMessage('');\n    setStudent(null);\n\n    try {\n      const response = await fetch('/api/attendance', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ studentId: studentId.trim() }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        setStudent(data.student);\n        setStatus(data.status);\n\n        switch (data.status) {\n          case 'allowed':\n            setMessage('✅ Meal allowed! Welcome!');\n            playSound(true);\n            break;\n          case 'already_used':\n            setMessage('❌ Meal already used for this period');\n            playSound(false);\n            break;\n          case 'invalid':\n            setMessage('❌ Student ID not found');\n            playSound(false);\n            break;\n          default:\n            setMessage('❌ Unknown status');\n            playSound(false);\n        }\n      } else {\n        setMessage('❌ System error. Please try again.');\n        playSound(false);\n      }\n    } catch (error) {\n      setMessage('❌ Network error. Please check connection.');\n      playSound(false);\n    } finally {\n      setIsLoading(false);\n      setStudentId('');\n      // Refocus input for next scan\n      setTimeout(() => {\n        if (inputRef.current) {\n          inputRef.current.focus();\n        }\n      }, 100);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await fetch('/api/logout', { method: 'POST' });\n      onLogout();\n    } catch (error) {\n      console.error('Logout error:', error);\n      onLogout(); // Logout anyway\n    }\n  };\n\n  return (\n    <div className=\"attendance-container\">\n      <div className=\"attendance-header\">\n        <div className=\"header-left\">\n          <img src=\"/images/salale_university_logo.png\" alt=\"Salale University\" />\n          <h1>Salale University</h1>\n        </div>\n        <button onClick={handleLogout} className=\"logout-btn\">\n          <i className=\"fas fa-sign-out-alt\"></i>\n          Logout\n        </button>\n      </div>\n\n      <div className=\"attendance-content\">\n        <div className=\"attendance-layout\">\n          {/* Left side: Input form */}\n          <div className=\"input-section\">\n            <div className=\"input-card\">\n              <form onSubmit={handleSubmit}>\n                <label htmlFor=\"studentId\">Student ID (Manual or Scan Barcode):</label>\n                <input\n                  ref={inputRef}\n                  type=\"text\"\n                  id=\"studentId\"\n                  value={studentId}\n                  onChange={(e) => setStudentId(e.target.value)}\n                  placeholder=\"Enter ID\"\n                  autoComplete=\"off\"\n                  required\n                />\n                <button type=\"submit\" className=\"check-btn\" disabled={isLoading}>\n                  {isLoading ? 'Checking...' : 'Check Attendance'}\n                </button>\n              </form>\n\n              {message && (\n                <div className={`attendance-message ${status}`}>\n                  {message}\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right side: Student information */}\n          <div className=\"result-section\">\n            {student && (\n              <div className=\"student-card\">\n                <div className={`status-message ${status}`}>\n                  {status === 'allowed' ? '✅ ALLOWED' : \n                   status === 'already_used' ? '❌ ALREADY USED' : \n                   '❌ DENIED'}\n                </div>\n                <div className=\"student-info-row\">\n                  <div className=\"student-details\">\n                    <div><strong>Name:</strong> {student.name}</div>\n                    <div><strong>ID Number:</strong> {student.id}</div>\n                    <div><strong>Program:</strong> {student.department}</div>\n                  </div>\n                    \n                  <div className=\"student-photo\">\n                    <img \n                      src={student.photoUrl || '/images/default-student.png'} \n                      alt=\"Student Photo\"\n                      onError={(e) => {\n                        e.target.src = '/images/default-student.png';\n                      }}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Audio elements */}\n      <audio ref={successAudioRef} preload=\"auto\">\n        <source src=\"/sounds/success.mp3\" type=\"audio/mpeg\" />\n      </audio>\n      <audio ref={errorAudioRef} preload=\"auto\">\n        <source src=\"/sounds/error.mp3\" type=\"audio/mpeg\" />\n      </audio>\n    </div>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}